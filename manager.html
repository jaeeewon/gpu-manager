<head>
    <title>LangAI GPU ë³µêµ¬</title>
</head>

<h1>wakeup 4090 ğŸ˜­</h1>
<h4>GPUê°€ ì–´ë–¤ ì´ìœ ì—ì„ ì§€ ìê¾¸ ì£½ëŠ”ë°,, ë§¤ë²ˆ ì œê°€ ì‚´ë¦´ ìˆ˜ ì—†ì–´ì„œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤</h4>

<label for="instance">ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</label>
<select onchange="clearVisibles()" id="instance">
    <option value="1">hufs01</option>
    <option value="2">hufs02</option>
    <option value="3">hufs03</option>
    <option value="4">hufs04</option>
</select>

<button onclick="getGpuStatus()">GPU ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸°</button>
<button style="display: none;" id="reset" onclick="resetInstance()">ì¸ìŠ¤í„´ìŠ¤ ì¬ì‹œì‘(ë¬¸ì œ í•´ê²°í•˜ê¸°)</button>

<pre id="output" style="margin-top: 20px; padding: 10px;"></pre>

<script>
    const pre = document.getElementById('output')
    const reset = document.getElementById('reset')
    let PASSWORD = '';

    function pwAssertion() {
        while (PASSWORD.length !== 4) PASSWORD = prompt(PASSWORD === 'unauth' ? 'ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜! ë‹¤ì‹œ ì…ë ¥' : 'ë¹„ë°€ë²ˆí˜¸ ì…ë ¥')
    }

    function setStatus(stdout) {
        const isOk = !stdout.includes('Failed to initialize NVML: Unknown Error')
        pre.textContent = stdout;
        pre.style.color = isOk ? 'green' : 'red'
        reset.style.display = isOk ? 'none' : ''
    }

    function clearVisibles() {
        pre.textContent = '';
        reset.style.display = 'none'
    }

    async function getGpuStatus() {
        clearVisibles()
        pwAssertion()
        const no = document.getElementById('instance').value;
        const res = await fetch(`/get-gpu-status?no=${no}&pass=${PASSWORD}`);

        if (res.status === 401) {
            PASSWORD = 'unauth';
            return await getGpuStatus()
        }

        const json = await res.json();
        setStatus(json.success ? json.data.stdout : 'Error: ' + json.message);
    }

    async function resetInstance() {
        clearVisibles()
        pwAssertion()
        const no = document.getElementById('instance').value;
        const res = await fetch(`/reset-instance?no=${no}&pass=${PASSWORD}`, { method: 'POST' });

        if (res.status === 401) {
            PASSWORD = 'unauth';
            return await resetInstance()
        }

        const json = await res.json();
        setStatus(json.success ? json.data.stdout : 'Error: ' + json.message);
    }
</script>